# Adobe Firefly MCP Hub - Docker Compose
#
# Usage:
#   docker-compose up -d
#
# For HTTP transport:
#   MCP_TRANSPORT=http docker-compose up -d

version: "3.8"

services:
  firefly-mcp-hub:
    build:
      context: .
      dockerfile: Dockerfile
    image: firefly-mcp-hub:latest
    container_name: firefly-mcp-hub
    restart: unless-stopped
    environment:
      # Required: Adobe Credentials
      - FIREFLY_CLIENT_ID=${FIREFLY_CLIENT_ID}
      - FIREFLY_CLIENT_SECRET=${FIREFLY_CLIENT_SECRET}
      # Optional: Server Configuration
      - MCP_TRANSPORT=${MCP_TRANSPORT:-stdio}
      - MCP_HTTP_PORT=${MCP_HTTP_PORT:-3000}
      - MCP_LOG_LEVEL=${MCP_LOG_LEVEL:-info}
      - NODE_ENV=production
    ports:
      # Only exposed when using HTTP transport
      - "${MCP_HTTP_PORT:-3000}:3000"
    volumes:
      # Persist logs
      - firefly-logs:/app/logs
    # For STDIO transport, enable interactive mode
    stdin_open: true
    tty: true
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 1G
        reservations:
          cpus: "0.5"
          memory: 256M

volumes:
  firefly-logs:
    driver: local
